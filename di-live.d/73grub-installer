#!/bin/sh

. /usr/share/debconf/confmodule

db_capb backup

if ! grep -q '/target ' /proc/mounts && \
   ! grep -q '/target/ ' /proc/mounts; then
    db_input critical base-installer/no_target_mounted || true
    db_go || exit 10
fi

# mount /dev and /proc on target otherwise grub-installer will fail
# this should have been handled by live-installer
if ! grep -q /target/dev /proc/mounts; then
    mount -o bind /dev /target/dev
fi

if ! grep -q /target/proc /proc/mounts; then
    mount -o bind /proc /target/proc
fi

PATH=/usr/lib/di-live/compat:$PATH /usr/share/grub-installer/grub-installer /target

umount -f /target/proc
umount -f /target/dev

